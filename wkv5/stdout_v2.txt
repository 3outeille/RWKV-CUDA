Using /root/.cache/torch_extensions/py38_cu121 as PyTorch extensions root...
Creating extension directory /root/.cache/torch_extensions/py38_cu121/wkv5_ref...
Detected CUDA files, patching ldflags
Emitting ninja build file /root/.cache/torch_extensions/py38_cu121/wkv5_ref/build.ninja...
Building extension module wkv5_ref...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1/3] /usr/local/cuda/bin/nvcc  -DTORCH_EXTENSION_NAME=wkv5_ref -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1013\" -isystem /usr/local/lib/python3.8/dist-packages/torch/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/torch/csrc/api/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/TH -isystem /usr/local/lib/python3.8/dist-packages/torch/include/THC -isystem /usr/local/cuda/include -isystem /usr/include/python3.8 -D_GLIBCXX_USE_CXX11_ABI=1 -D__CUDA_NO_HALF_OPERATORS__ -D__CUDA_NO_HALF_CONVERSIONS__ -D__CUDA_NO_BFLOAT16_CONVERSIONS__ -D__CUDA_NO_HALF2_OPERATORS__ --expt-relaxed-constexpr -gencode=arch=compute_52,code=sm_52 -gencode=arch=compute_60,code=sm_60 -gencode=arch=compute_61,code=sm_61 -gencode=arch=compute_70,code=sm_70 -gencode=arch=compute_75,code=sm_75 -gencode=arch=compute_80,code=sm_80 -gencode=arch=compute_86,code=sm_86 -gencode=arch=compute_90,code=compute_90 -gencode=arch=compute_90,code=sm_90 --compiler-options '-fPIC' -res-usage --use_fast_math -O3 -Xptxas -O3 --extra-device-vectorization -DN=2 -std=c++17 -c /data/user/cangshui/bbuf/RWKV-CUDA/wkv5/cuda/wkv5_cuda_ref.cu -o wkv5_cuda_ref.cuda.o 
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_52'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 70 registers, 432 bytes cmem[0], 236 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_52'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 384 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_60'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 70 registers, 432 bytes cmem[0], 236 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_60'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 384 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_61'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 70 registers, 432 bytes cmem[0], 236 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_61'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 384 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_70'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_70'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_75'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_75'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 60 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_80'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_80'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_86'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_86'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_90'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_90'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers
[2/3] c++ -MMD -MF wkv5_ref.o.d -DTORCH_EXTENSION_NAME=wkv5_ref -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1013\" -isystem /usr/local/lib/python3.8/dist-packages/torch/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/torch/csrc/api/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/TH -isystem /usr/local/lib/python3.8/dist-packages/torch/include/THC -isystem /usr/local/cuda/include -isystem /usr/include/python3.8 -D_GLIBCXX_USE_CXX11_ABI=1 -fPIC -std=c++17 -c /data/user/cangshui/bbuf/RWKV-CUDA/wkv5/cuda/wkv5_ref.cpp -o wkv5_ref.o 
[3/3] c++ wkv5_ref.o wkv5_cuda_ref.cuda.o -shared -L/usr/local/lib/python3.8/dist-packages/torch/lib -lc10 -lc10_cuda -ltorch_cpu -ltorch_cuda -ltorch -ltorch_python -L/usr/local/cuda/lib64 -lcudart -o wkv5_ref.so
Loading extension module wkv5_ref...
Using /root/.cache/torch_extensions/py38_cu121 as PyTorch extensions root...
Creating extension directory /root/.cache/torch_extensions/py38_cu121/wkv5...
Detected CUDA files, patching ldflags
Emitting ninja build file /root/.cache/torch_extensions/py38_cu121/wkv5/build.ninja...
Building extension module wkv5...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
[1/3] /usr/local/cuda/bin/nvcc  -DTORCH_EXTENSION_NAME=wkv5 -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1013\" -isystem /usr/local/lib/python3.8/dist-packages/torch/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/torch/csrc/api/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/TH -isystem /usr/local/lib/python3.8/dist-packages/torch/include/THC -isystem /usr/local/cuda/include -isystem /usr/include/python3.8 -D_GLIBCXX_USE_CXX11_ABI=1 -D__CUDA_NO_HALF_OPERATORS__ -D__CUDA_NO_HALF_CONVERSIONS__ -D__CUDA_NO_BFLOAT16_CONVERSIONS__ -D__CUDA_NO_HALF2_OPERATORS__ --expt-relaxed-constexpr -gencode=arch=compute_52,code=sm_52 -gencode=arch=compute_60,code=sm_60 -gencode=arch=compute_61,code=sm_61 -gencode=arch=compute_70,code=sm_70 -gencode=arch=compute_75,code=sm_75 -gencode=arch=compute_80,code=sm_80 -gencode=arch=compute_86,code=sm_86 -gencode=arch=compute_90,code=compute_90 -gencode=arch=compute_90,code=sm_90 --compiler-options '-fPIC' -res-usage --use_fast_math -O3 -Xptxas -O3 --extra-device-vectorization -DN=2 -DCC=4 -std=c++17 -c /data/user/cangshui/bbuf/RWKV-CUDA/wkv5/cuda/wkv5_cuda_v1.cu -o wkv5_cuda_v1.cuda.o 
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_52'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 70 registers, 432 bytes cmem[0], 236 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_52'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 384 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_60'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 70 registers, 432 bytes cmem[0], 236 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_60'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 384 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_61'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 70 registers, 432 bytes cmem[0], 236 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_61'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 384 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_70'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_70'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_75'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_75'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 60 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_80'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_80'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_86'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers, 464 bytes cmem[0], 184 bytes cmem[2]
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_86'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers, 416 bytes cmem[0]
ptxas info    : 0 bytes gmem
ptxas info    : Compiling entry function '_Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_' for 'sm_90'
ptxas info    : Function properties for _Z15kernel_backwardIfEviiiiPKT_S2_S2_S2_S2_S2_S2_PS0_S3_S3_S3_S3_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 66 registers
ptxas info    : Function properties for __internal_accurate_pow
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Compiling entry function '_Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_' for 'sm_90'
ptxas info    : Function properties for _Z14kernel_forwardIfEviiiiPKT_S2_S2_S2_S2_PS0_
    0 bytes stack frame, 0 bytes spill stores, 0 bytes spill loads
ptxas info    : Used 40 registers
[2/3] c++ -MMD -MF wkv5_op.o.d -DTORCH_EXTENSION_NAME=wkv5 -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\"_gcc\" -DPYBIND11_STDLIB=\"_libstdcpp\" -DPYBIND11_BUILD_ABI=\"_cxxabi1013\" -isystem /usr/local/lib/python3.8/dist-packages/torch/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/torch/csrc/api/include -isystem /usr/local/lib/python3.8/dist-packages/torch/include/TH -isystem /usr/local/lib/python3.8/dist-packages/torch/include/THC -isystem /usr/local/cuda/include -isystem /usr/include/python3.8 -D_GLIBCXX_USE_CXX11_ABI=1 -fPIC -std=c++17 -c /data/user/cangshui/bbuf/RWKV-CUDA/wkv5/cuda/wkv5_op.cpp -o wkv5_op.o 
[3/3] c++ wkv5_op.o wkv5_cuda_v1.cuda.o -shared -L/usr/local/lib/python3.8/dist-packages/torch/lib -lc10 -lc10_cuda -ltorch_cpu -ltorch_cuda -ltorch -ltorch_python -L/usr/local/cuda/lib64 -lcudart -o wkv5.so
Loading extension module wkv5...


Check CUDA kernel v1 correctness...
result
[[[ 0.421  -0.3711  0.0178 -0.0139]
  [-0.364   0.3071 -0.2456  0.2054]
  [ 0.1479 -0.2311  0.1586 -0.1472]
  [ 0.5119 -0.2809 -0.494   0.382 ]
  [ 0.1804 -0.1289  0.1603  0.1426]]

 [[-0.0629  0.1919 -0.1541 -0.4142]
  [-0.0074 -0.0228  0.1135 -0.5203]
  [ 0.0571  0.0353 -0.6113  0.6401]
  [ 0.3185  0.2417 -0.1096 -0.1544]
  [ 0.617   0.5978  0.5797 -0.1515]]]

result
[[[ 0.421  -0.3711  0.0178 -0.0139]
  [-0.364   0.3071 -0.2456  0.2054]
  [ 0.1479 -0.2311  0.1586 -0.1472]
  [ 0.5119 -0.2809 -0.494   0.382 ]
  [ 0.1804 -0.1289  0.1603  0.1426]]

 [[-0.0629  0.1919 -0.1541 -0.4142]
  [-0.0074 -0.0228  0.1135 -0.5203]
  [ 0.0571  0.0353 -0.6113  0.6401]
  [ 0.3185  0.2417 -0.1096 -0.1544]
  [ 0.617   0.5978  0.5797 -0.1515]]]

result
[[[ 0.421  -0.3711  0.0178 -0.0139]
  [-0.364   0.3071 -0.2456  0.2054]
  [ 0.1479 -0.2311  0.1586 -0.1472]
  [ 0.5119 -0.2809 -0.494   0.382 ]
  [ 0.1804 -0.1289  0.1603  0.1426]]

 [[-0.0629  0.1919 -0.1541 -0.4142]
  [-0.0074 -0.0228  0.1135 -0.5203]
  [ 0.0571  0.0353 -0.6113  0.6401]
  [ 0.3185  0.2417 -0.1096 -0.1544]
  [ 0.617   0.5978  0.5797 -0.1515]]]

--> correct = True True , err ratio = 7.50345904778167e-08 8.464954548993876e-08
# Check torch ref
--> g_r correct = True , err ratio = 7.771651157447063e-08
--> g_k correct = True , err ratio = 8.818861345845884e-08
--> g_v correct = True , err ratio = 8.810072976157927e-08
--> g_w correct = True , err ratio = 1.3513227925084854e-07
--> g_u correct = True , err ratio = 1.2519209405347803e-07
# Check CUDA Ref
--> g_r correct = True , err ratio = 1.1631952227530891e-07
--> g_k correct = True , err ratio = 5.099966057039042e-08
--> g_v correct = True , err ratio = 8.925613576395178e-08
--> g_w correct = True , err ratio = 9.755736207486488e-08
--> g_u correct = True , err ratio = 3.9589214966703635e-08
